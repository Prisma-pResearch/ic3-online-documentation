<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-datasets/phase2">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">Phase 2 - Data Cleaning | Intelligent Critical Care Center Online Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Chesterguan.github.io/ic3-online-documentation/docs/datasets/phase2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Phase 2 - Data Cleaning | Intelligent Critical Care Center Online Documentation"><meta data-rh="true" name="description" content="Details of Phase 2 pipeline workflow"><meta data-rh="true" property="og:description" content="Details of Phase 2 pipeline workflow"><link data-rh="true" rel="icon" href="/ic3-online-documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Chesterguan.github.io/ic3-online-documentation/docs/datasets/phase2"><link data-rh="true" rel="alternate" href="https://Chesterguan.github.io/ic3-online-documentation/docs/datasets/phase2" hreflang="en"><link data-rh="true" rel="alternate" href="https://Chesterguan.github.io/ic3-online-documentation/docs/datasets/phase2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/ic3-online-documentation/blog/rss.xml" title="Intelligent Critical Care Center Online Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ic3-online-documentation/blog/atom.xml" title="Intelligent Critical Care Center Online Documentation Atom Feed"><link rel="stylesheet" href="/ic3-online-documentation/assets/css/styles.0493daec.css">
<link rel="preload" href="/ic3-online-documentation/assets/js/runtime~main.06976e31.js" as="script">
<link rel="preload" href="/ic3-online-documentation/assets/js/main.f346e76d.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ The document is in development!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ic3-online-documentation/"><div class="navbar__logo"><img src="/ic3-online-documentation/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ic3-online-documentation/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ic3-online-documentation/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/ic3-online-documentation/resources/intro">Resources</a><a class="navbar__item navbar__link" href="/ic3-online-documentation/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current,docs-resources-current"></div></div></div><a href="https://github.com/Prisma-pResearch" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ic3-online-documentation/docs/intro">Documentation Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/ic3-online-documentation/docs/category/featured-projects">Featured Projects</a><button aria-label="Toggle the collapsible sidebar category &#x27;Featured Projects&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/ic3-online-documentation/docs/category/datasets">Datasets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Datasets&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/category/datasets">Datasets Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/core_concepts">Core concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/InpatientDatabase">Inpatient Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/phase1">Phase 1 - Data Preprocessing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ic3-online-documentation/docs/datasets/phase2">Phase 2 - Data Cleaning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/phase3">Phase 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/sofacalculation">Phase 4 - SOFA Score Calculation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/phase5">Phase 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/Chorus">Chorus datasets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/IDEALIST">IDEALIST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ic3-online-documentation/docs/datasets/AKIEPIC2">AKIEPIC2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/ic3-online-documentation/docs/category/workspaces">Workspaces</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workspaces&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/ic3-online-documentation/docs/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ic3-online-documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/ic3-online-documentation/docs/category/datasets"><span itemprop="name">Datasets</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Phase 2 - Data Cleaning</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Phase 2 - Data Cleaning</h1></header><div style="text-align:justify"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="python-code-details">Python Code Details<a href="#python-code-details" class="hash-link" aria-label="Direct link to Python Code Details" title="Direct link to Python Code Details">​</a></h2><p>Below are the codes involved in this phase for cleaning various types of healthcare data files.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-clean_filespy">&gt; clean_files.py<a href="#-clean_filespy" class="hash-link" aria-label="Direct link to &gt; clean_files.py" title="Direct link to &gt; clean_files.py">​</a></h2><p>This script does data cleaning within healthcare data preprocessing pipeline, targeting various dataset types for enhancement by applying cleaning strategies, leverages specific functions for different data types, and handles large files efficiently, all while ensuring the data&#x27;s readiness for further analysis.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">WORKFLOW<a href="#workflow" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Initialization</summary><div><div class="collapsibleContent_i85q"><ul><li>Import Modules and Functions for data cleaning</li><li>Trigger &#x27;clean_df&#x27; Function which performs the entire cleaning process for different types of healthcare data</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Filename Components Extraction </summary><div><div class="collapsibleContent_i85q"><ul><li>Extract Output File Path Components like file name and batch numbers</li><li>It then Identifies the appropriate time index for visit detail labeling based on the file name, guiding the temporal aspects of the cleaning</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Load and Clean Data Based on File Type</summary><div><div class="collapsibleContent_i85q"><ul><li>Executes specific cleaning logic for each data type including but not limited to Blood Pressure, Respiratory, Labs, and Medications. This step involves calling dedicated cleaning functions for each data type, such as <code>clean_bp</code>, <code>clean_respiratory</code>, <code>clean_labs</code>, and <code>clean_meds</code>.<ul><li>If Blood Pressure Data, then it Calls <code>clean_bp</code> function to clean blood pressure data.</li><li>If Respiratory Data, then it Calls <code>clean_respiratory</code> function for respiratory data.</li><li>If Labs Data, it calls <code>clean_labs</code> for laboratory results.</li><li>If Medication Data, it calls <code>clean_meds</code> for medication data.</li><li>If other Data Types, it applies corresponding cleaning functions like <code>clean_mac</code>, <code>clean_vitals</code>, <code>clean_diagnoses</code>, <code>clean_dialysis</code>, <code>clean_mobility</code>, and others based on the file name.</li></ul></li><li>For files that require handling large datasets or have unique processing needs (e.g., medications), the script uses specific functions to manage these efficiently and avoid memory issues.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Saving and Final Cleanup</summary><div><div class="collapsibleContent_i85q"><ul><li>The cleaned data is saved to the specified output paths, with the option to split into batches for larger datasets.</li><li>To conserve disk space and maintain organization, intermediate files used during the cleaning process are removed after completion.</li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-append_station_infopy">&gt; append_station_info.py<a href="#-append_station_infopy" class="hash-link" aria-label="Direct link to &gt; append_station_info.py" title="Direct link to &gt; append_station_info.py">​</a></h2><p>This script has &#x27;append_station_label&#x27; function that handles the missing data of DataFrame by appending station information, including station names and types, based on encounter IDs and time indexes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-1">WORKFLOW<a href="#workflow-1" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Initialization</summary><div><div class="collapsibleContent_i85q"><ul><li>Checks if internal_stations_df and df are pandas DataFrames.</li><li>Initializes an in-memory SQLite database and transforms internal_stations_df and df into SQL tables within the SQLite environment.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Joining</summary><div><div class="collapsibleContent_i85q"><ul><li>Performs an SQL query to join the target DataFrame with station data based on the encounter ID and a time index within the station&#x27;s entry and exit times to enrich df with station and station_type.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Handling Missing Data</summary><div><div class="collapsibleContent_i85q"><ul><li>Check if there are any missing station_type values in the resulting DataFrame.</li><li>Further checks if encounter_df is provided.<ul><li>Utilizes encounter data to impute missing station_type values. This includes creating a temporary DataFrame for mapping missing types and merging it with the main DataFrame.</li><li>Uses a default location value (default_location) for any station_type values that remain missing after attempting the data-driven imputation.</li></ul></li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Updated Dataframe</summary><div><div class="collapsibleContent_i85q"><ul><li>Removes temporary columns that were used for the imputation process.</li><li>Returns the DataFrame with appended and imputed station information.</li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-clean_diagnosespy">&gt; clean_diagnoses.py<a href="#-clean_diagnosespy" class="hash-link" aria-label="Direct link to &gt; clean_diagnoses.py" title="Direct link to &gt; clean_diagnoses.py">​</a></h2><p>This script has &#x27;clean_diagnoses&#x27; function that cleans and consolidates diagnosis data within healthcare datasets, enhancing its integrity and utility by standardizing dates, correcting encounter IDs, and enriching diagnoses details. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-2">WORKFLOW<a href="#workflow-2" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Datetime Cleanup and Standardization</summary><div><div class="collapsibleContent_i85q"><ul><li>Formats date and time columns for consistency, a crucial step for accurate data comparisons and temporal joins.</li><li>Combines encounter IDs spread across multiple rows into single rows to address data fragmentation.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Correction of Encounter IDs in Diagnoses</summary><div><div class="collapsibleContent_i85q"><ul><li>If incorrect encounter IDs are found in the diagnosis file:<ul><li>Removes these IDs and fills in correct ones using the encounter file as a reference.</li></ul></li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Labeling of Discharge Diagnoses</summary><div><div class="collapsibleContent_i85q"><ul><li>If diagnoses are found in the encounters file for a specific encounter:<ul><li>Labels these diagnoses as present on admission (POA), distinguishing between pre-existing conditions and those developed during hospitalization.</li></ul></li><li>Adds admit diagnoses not previously recorded in the diagnosis file to provide a fuller picture of patient admissions.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Extraction and Processing of ICD Codes</summary><div><div class="collapsibleContent_i85q"><ul><li>Extracts ICD-9 and ICD-10 codes, along with free-text diagnoses, formatting them to fit the diagnosis dataset structure.<ul><li>If diagnosis flags for POA are present:<ul><li>Assigns POA indicators.</li></ul></li><li>Prioritizes diagnoses based on primary or secondary status.</li></ul></li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Merging and Final Cleanup</summary><div><div class="collapsibleContent_i85q"><ul><li>Merges the processed diagnosis information back into the main dataset, correcting errors and filling in gaps.<ul><li>If any diagnosis data rows still lack POA indicators after processing:<ul><li>Assigns default POA status based on available data.</li></ul></li><li>If problem list status information is missing:<ul><li>Adds default values to ensure dataset completeness.</li></ul></li></ul></li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-clean_macpy">&gt; clean_MAC.py<a href="#-clean_macpy" class="hash-link" aria-label="Direct link to &gt; clean_MAC.py" title="Direct link to &gt; clean_MAC.py">​</a></h2><p>This script has &#x27;clean_mac&#x27; function that processes and adjusts MAC values within healthcare datasets, engaging several functions to refine the data based on patient age and the specific anesthetic used.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-3">WORKFLOW<a href="#workflow-3" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Initialization</summary><div><div class="collapsibleContent_i85q"><ul><li>Imports and constants are defined for use across the script.</li><li>Initializes the cleaning process, orchestrating the flow and invoking other functions as needed.</li><li>Converts encounter and birth dates to datetime format for calculation purposes.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Calculate Patient Age</summary><div><div class="collapsibleContent_i85q"><ul><li>Invokes &#x27;calculate_age&#x27; function to determine the patient&#x27;s age at the time of the encounter.</li><li>Maps patient ages to their respective encounters for later reference.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Prepare MAC DataFrame</summary><div><div class="collapsibleContent_i85q"><ul><li>Renames and selects relevant columns for processing.</li><li>Formats datetime and numeric fields for consistency.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Calculate MAC for Age=40</summary><div><div class="collapsibleContent_i85q"><ul><li>Filters MAC dataframe for relevant anesthetic types.</li><li>Invokes &#x27;calculate_mac40&#x27; function for each row to compute the MAC value at age 40 based on the type of anesthetic used.</li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Adjust MAC Values Based on Actual Age</summary><div><div class="collapsibleContent_i85q"><ul><li>Applies &#x27;compute_mac_val&#x27; function to adjust the MAC values based on the actual age of the patient, using the age dictionary created earlier.</li><li>It then tailors MAC calculations to the individual patient, factoring in the physiological changes that affect anesthetic concentration requirements.</li><li>It then calls &#x27;remove_artifacts&#x27; function to clean up unrealistic MAC values (outside the range of 0 to 2), ensuring data integrity.</li><li>Merges the adjusted MAC values back into the main dataframe, organizing and preparing the dataset for analysis.</li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-clean_dialysispy">&gt; clean_dialysis.py<a href="#-clean_dialysispy" class="hash-link" aria-label="Direct link to &gt; clean_dialysis.py" title="Direct link to &gt; clean_dialysis.py">​</a></h2><p>This script has &#x27;clean_dialysis&#x27; function that consolidates dialysis and CRRT (Continuous Renal Replacement Therapy) data into a single, clean DataFrame by standardizing column names and consolidating records.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-4">WORKFLOW<a href="#workflow-4" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Transformation</summary><div><div class="collapsibleContent_i85q"><p>In dialysis_df,</p><ul><li>If the column &#x27;measurement_name&#x27; exists:<ul><li>Rename &#x27;measurement_name&#x27; to &#x27;vital_sign_measure_name&#x27; and &#x27;measurement_value&#x27; to &#x27;meas_value&#x27;.</li></ul></li><li>Else:<ul><li>Identify columns common to both dataframes (ID columns and &#x27;observation_datetime&#x27;).</li><li>Melt &#x27;dialysis_df&#x27; to reshape data, with ID columns and &#x27;observation_datetime&#x27; as &#x27;id_vars&#x27;, and the rest as &#x27;value_vars&#x27;.</li><li>Rename the melted variable column to &#x27;vital_sign_measure_name&#x27; and the value column to &#x27;meas_value&#x27;.</li><li>Drop rows where &#x27;meas_value&#x27; is NaN.</li></ul></li><li>Rename columns in &#x27;crrt_df&#x27; for consistency:<ul><li>&#x27;recorded_time&#x27; to &#x27;observation_datetime&#x27;.</li><li>&#x27;group_display_name&#x27; to &#x27;vital_sign_group_name&#x27; (if exists).</li><li>&#x27;group_measure_name&#x27; to &#x27;vital_sign_measure_name&#x27; (if exists).</li><li>&#x27;measure_value&#x27; to &#x27;meas_value&#x27;.</li></ul></li><li>Concatenate &#x27;crrt_df&#x27; and &#x27;dialysis_df&#x27; along rows.</li><li>Drop rows with NaN in &#x27;meas_value&#x27;.</li><li>Return the unified and cleaned DataFrame.</li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-clean_mobilitypy">&gt; clean_mobility.py<a href="#-clean_mobilitypy" class="hash-link" aria-label="Direct link to &gt; clean_mobility.py" title="Direct link to &gt; clean_mobility.py">​</a></h2><p>This script has &#x27;clean_mobility&#x27; function that handles mobility data cleaning process by transforming the dataset into a long format and removing any missing values.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-5">WORKFLOW<a href="#workflow-5" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Transformation</summary><div><div class="collapsibleContent_i85q"><p>In mobility_df,</p><ul><li>Transform the mobility_df from wide to long format.<ul><li>id_vars: Specifies columns to remain vertical (unchanged), identified by intersecting mobility_df columns with key identifiers (pid, o_eid, eid, recorded_time, and batch_visit_detail_id).</li><li>var_name: Sets the name of the new variable column to &#x27;measure_name&#x27;, which holds original column names.</li><li>value_name: Sets the name of the new value column to &#x27;meas_value&#x27;, which holds the values of the original columns.</li></ul></li><li>Removes rows where the meas_value is NaN, ensuring the cleaned DataFrame contains only valid measurements.</li><li>Returns the cleaned mobility_df in a long format with measurements standardized under measure_name and meas_value.</li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-clean_vitalspy">&gt; clean_vitals.py<a href="#-clean_vitalspy" class="hash-link" aria-label="Direct link to &gt; clean_vitals.py" title="Direct link to &gt; clean_vitals.py">​</a></h2><p>This script has &#x27;clean_vitals&#x27; function that cleans vital signs data, specifically heart rate and temperature, including outlier removal and adjustment based on measurement source.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-6">WORKFLOW<a href="#workflow-6" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Initialization</summary><div><div class="collapsibleContent_i85q"><ul><li>Imports necessary libraries and functions.</li><li>Defines minimum and maximum acceptable values for heart rate and temperature.</li><li>Checks if &#x27;measurement_name&#x27; exists in &#x27;vitals_df&#x27;. If so, reshapes the DataFrame using &#x27;stack_df&#x27;.    </li></ul></div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Cleaning</summary><div><div class="collapsibleContent_i85q"><ul><li>Converts Fahrenheit to Celsius if &#x27;temp_celsius&#x27; is missing but &#x27;temp_fahrenheit&#x27; is available.</li><li>Filters columns, drops rows missing time or measured value, sorts by &#x27;eid&#x27; and &#x27;time_index&#x27;, performs value adjustments based on source, and removes values outside acceptable range.</li><li>Adjusts temperature based on source (_correct_temp_type function called within &#x27;vitals_outlier_detection&#x27; for temperature sources).</li><li>Performs similar filteration steps for heart rate data</li><li>Returns two cleaned DataFrames: one for temperature and one for heart rate, ready for further analysis.</li></ul></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-label_visit_idpy">&gt; label_visit_id.py<a href="#-label_visit_idpy" class="hash-link" aria-label="Direct link to &gt; label_visit_id.py" title="Direct link to &gt; label_visit_id.py">​</a></h2><p>This script has &#x27;label_visit_id&#x27; function that outputs a DataFrame with visit detail labels by matching entries to station data based on time and patient ID, optionally including station labels.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-7">WORKFLOW<a href="#workflow-7" class="hash-link" aria-label="Direct link to WORKFLOW" title="Direct link to WORKFLOW">​</a></h4><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Visit Details Label Matching</summary><div><div class="collapsibleContent_i85q"><ul><li>Prepares df and stations_df for SQL operations.</li><li>Creates an in-memory SQLite database and loads both DataFrames.</li><li>Executes an SQL query to join the DataFrames based on pid and df_time_index within the stations_df&#x27;s entry and exit times.</li><li>Optionally includes station label and type in the output based on include_station_label.</li><li>Returns df with visit details labeled, including an intraoperative flag.</li></ul></div></div></details><h1>Phase 2 Comprehensive Flowchart</h1><p>Below is the comprehensive high level flowchart of entire Phase 2 processes</p><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1klEQVQYlUWMy26DMBRE/f8f1lU3BEhIVRlsaHEC9vWb5VSYNCyORnNGGkYh4x+XN/xwh+9PDW0SbNreG6Owwfhc2IWaAuTNQlOGCadnJiboELE4Dx0jZEfoPhSUOvrubc5gv4PHY4qYhYeaIpSMmHnALD0e48uPAayvCKK14JXBUBP6i4FojxwaKm6HiavB+GUhOoK8W4jbmePdQna2dMYrXR5FYyFbh75+PZY8/A5bKULbBH7RGFqD5xqgKWEx4fQNgRmfsNqAWbmCqF15fpJ/+2WN+APE4E83u23T9wAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="640" height="569"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/ic3-online-documentation/assets/ideal-img/phase 2.4c79723.640.png" srcset="/ic3-online-documentation/assets/ideal-img/phase 2.4c79723.640.png 640w,/ic3-online-documentation/assets/ideal-img/phase 2.638c20b.1030.png 1030w" width="640" height="569"></noscript></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Start</summary><div><div class="collapsibleContent_i85q">The process begins with clean_files.py, which acts as the orchestrator for cleaning various types of healthcare data files.</div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Type Decision</summary><div><div class="collapsibleContent_i85q">Based on the type of data file (MAC, diagnoses, dialysis, mobility, vitals, etc.), clean_files.py directs the flow to the corresponding cleaning script.</div></div></details><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Data Cleanup based on data type</summary><div><div class="collapsibleContent_i85q"><ul><li>For MAC Data: Calls clean_MAC.py, which internally uses functions to calculate age-adjusted MAC values and to clean the data.</li><li>For Diagnoses Data: Calls clean_diagnoses.py for standardizing diagnosis records. This process might involve using label_visit_id.py to label data with visit IDs based on station info.</li><li>For Dialysis Data: Calls clean_dialysis.py to unify and clean dialysis and CRRT files.</li><li>For Mobility Data: Directs to clean_mobility.py for melting and cleaning mobility measurements.</li><li>For Vitals Data: Might call clean_vitals.py and label_visit_id.py for cleaning vital signs data and labeling them with visit IDs, respectively.</li><li>Append Station Info: Utilizes append_station_info.py to enrich datasets with station-related information, possibly requiring visit IDs from label_visit_id.py.</li></ul><p>Each script returns a cleaned or enhanced version of the dataset, ready for further analysis or integration into larger datasets.</p></div></div></details></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Prisma-pResearch/ic3-online-documentation/edit/main/websites/docs/datasets/phase2.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-02-03T22:20:40.000Z">Feb 3, 2025</time></b> by <b>srisharanya Injarapu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/ic3-online-documentation/docs/datasets/phase1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Phase 1 - Data Preprocessing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ic3-online-documentation/docs/datasets/phase3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Phase 3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#python-code-details" class="table-of-contents__link toc-highlight">Python Code Details</a></li><li><a href="#-clean_filespy" class="table-of-contents__link toc-highlight">&gt; clean_files.py</a></li><li><a href="#-append_station_infopy" class="table-of-contents__link toc-highlight">&gt; append_station_info.py</a></li><li><a href="#-clean_diagnosespy" class="table-of-contents__link toc-highlight">&gt; clean_diagnoses.py</a></li><li><a href="#-clean_macpy" class="table-of-contents__link toc-highlight">&gt; clean_MAC.py</a></li><li><a href="#-clean_dialysispy" class="table-of-contents__link toc-highlight">&gt; clean_dialysis.py</a></li><li><a href="#-clean_mobilitypy" class="table-of-contents__link toc-highlight">&gt; clean_mobility.py</a></li><li><a href="#-clean_vitalspy" class="table-of-contents__link toc-highlight">&gt; clean_vitals.py</a></li><li><a href="#-label_visit_idpy" class="table-of-contents__link toc-highlight">&gt; label_visit_id.py</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ic3-online-documentation/docs/category/featured-projects">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/ic3-online-documentation/docs/category/datasets">Datasets</a></li><li class="footer__item"><a class="footer__link-item" href="/ic3-online-documentation/docs/category/tutorials">Tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><div> <a class="footer__link-item" href="https://ufhealth.org/" style="list-style: none; color: white;" onmouseover='this.style.color="#005494"' onmouseout='this.style.color="#FFF"'>UF Health</a></div></li><li class="footer__item"><div> <a class="footer__link-item" href="https://twitter.com/UF_IC3" style="list-style: none; color: white;" onmouseover='this.style.color="#005494"' onmouseout='this.style.color="#FFF"'>Twitter</a></div></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ic3-online-documentation/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://ic3.center.ufl.edu" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/ic3-online-documentation/img/Intelligent Critical Care Center.png" alt="ic3 logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/ic3-online-documentation/img/Intelligent Critical Care Center.png" alt="ic3 logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2025 Intelligent Critical Care Center, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ic3-online-documentation/assets/js/runtime~main.06976e31.js"></script>
<script src="/ic3-online-documentation/assets/js/main.f346e76d.js"></script>
</body>
</html>